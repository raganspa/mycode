---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVDekNDQXZPZ0F3SUJBZ0lUS0ZkTGZQQi9kUFpEbnIwS1BraEFUMXFEbmpBTkJna3Foa2lHOXcwQkFRc0YKQURCd01Rc3dDUVlEVlFRR0V3SlZVekVWTUJNR0ExVUVDQk1NVUdWdWJuTjViSFpoYm1saE1STXdFUVlEVlFRSApFd3BJWVhKeWFYTmlkWEpuTVJNd0VRWURWUVFLRXdwTGRXSmxjbTVsZEdWek1Rc3dDUVlEVlFRTEV3SkRRVEVUCk1CRUdBMVVFQXhNS1MzVmlaWEp1WlhSbGN6QWVGdzB5TURBNE1ETXhOekUxTURCYUZ3MHlNVEE0TURNeE56RTEKTURCYU1IRXhDekFKQmdOVkJBWVRBbFZUTVJVd0V3WURWUVFJRXd4UVpXNXVjM2xzZG1GdWFXRXhFekFSQmdOVgpCQWNUQ2toaGNuSnBjMkoxY21jeEV6QVJCZ05WQkFvVENrdDFZbVZ5Ym1WMFpYTXhJVEFmQmdOVkJBc1RHRXQxClltVnlibVYwWlhNZ1ZHaGxJRUZzZEdFeklGZGhlVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0MKQVFvQ2dnRUJBTmlrUU1PU3Q0ajFHUk12T014L2tXaFlQZk8wekxPcGd5ZjBLLzYrM1pCaWV4UThsbmFSaU83UApDRWlhZ3I4WnB5Z2JINHhqTWpCa281cWhZcTlwcnpSVTh6c3dlbnl1dnBhNnJnR3ppVjVmWnU0RmwvMXMzVFN1CllSb2V4MjhjWnd4ZjBadkNTa2YrSHpvdlNNUTBZTkhsTTdDbjhNb0E4VGN4YnJCOVFnRVA4Q1ZGWjJRU1JvanMKQmcvNUFxQm52b0pmTnFtdE1rVDRuWmJqM3B2UVV5YUlja3lDTDNNRmhuSnlOLzU2T3RuOHAxSy9ncU13RHlGYwpXcXFaU2NnWEd3c3doK1lWcFZFbW03TXVGUndZbXpuZmd6aGdHbnArSHc3ZEFLcW5JZVFFYVlTM1RDQ3VmTWszCm5tOTl3Wmd0UldjaGNJQ2tNNzU1VzVDbURkaUI4WGtDQXdFQUFhT0JuRENCbVRBT0JnTlZIUThCQWY4RUJBTUMKQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQXdHQTFVZEV3RUIvd1FDTUFBdwpIUVlEVlIwT0JCWUVGTXlEYzNxMCsxd0l5S3ZmQThOT29kYWtucmFBTUI4R0ExVWRJd1FZTUJhQUZDem0yNkdNCmdHNUswR0VPM0hyc2VFMzZOSDdUTUJvR0ExVWRFUVFUTUJHQ0NXeHZZMkZzYUc5emRJY0Vmd0FBQVRBTkJna3EKaGtpRzl3MEJBUXNGQUFPQ0FRRUFrbmg4WmN2akF5UjNEM2YvbEx0SVdFSzB6b1lpSG1EeUsyTE01Zi9sa2FZYQpGclRJNXFsMENrdngzZ1BQQ0VxckszbHdreU5hSndKanllZHlBc1YzSy9CYUlBa1VhOVNqRzZ3VWVNaHR4SEdlClhNZnBiaEZCb0RaZWlpRjdSZFlmM2Y3Tjg0dTNlYzJYcGd3VzVHcW0zSmE4V0s1TmFtYmk5OERiMzM0c0tGWE4KbS9lN2RZVkh2ZVFiRFlzOEdrSWE0VnlmdklSOU1jbUUyMUJVM1FaVjhKWEk3V1hZOVIwUUt4bnNibEwycVI0WgpKRHpGS3VVZ1lDRk9Ta3BVeEhGcUxydnp0VVFXNGk3THhvRWg5c3dTSEVMSnUxcXBNSmxFbTBrTzV5ajQvM3hnCjgvT2M4SWt1NUFFdkNPbkFOWktPK1RrdGxqRldDTzlIL1UxOE55YjduUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMktSQXc1SzNpUFVaRXk4NHpIK1JhRmc5ODdUTXM2bURKL1FyL3I3ZGtHSjdGRHlXCmRwR0k3czhJU0pxQ3Z4bW5LQnNmakdNeU1HU2ptcUZpcjJtdk5GVHpPekI2Zks2K2xycXVBYk9KWGw5bTdnV1gKL1d6ZE5LNWhHaDdIYnh4bkRGL1JtOEpLUi80Zk9pOUl4RFJnMGVVenNLZnd5Z0R4TnpGdXNIMUNBUS93SlVWbgpaQkpHaU93R0Qva0NvR2UrZ2w4MnFhMHlSUGlkbHVQZW05QlRKb2h5VElJdmN3V0djbkkzL25vNjJmeW5VcitDCm96QVBJVnhhcXBsSnlCY2JDekNINWhXbFVTYWJzeTRWSEJpYk9kK0RPR0FhZW40ZkR0MEFxcWNoNUFScGhMZE0KSUs1OHlUZWViMzNCbUMxRlp5RndnS1F6dm5sYmtLWU4ySUh4ZVFJREFRQUJBb0lCQUU2cnZ4VUdWMzMxdTRoYQo4cDVZaVA1Q1pTVDErQXdhTjVXdnRyWklxMzcrTkVIU0NyVzkvZUx5N2Nnbnkra0hzTXNBcG9FOW1JRTRXcTBSCmhCdTlIakc3MDZRZjQ2c1piZjZnaGdYNkk1MVF1YmtmOE9USHZzQ2R2b2RVdkFtZVg5Ri9qa2VvMDM2M1NyRy8KY0FaSUd3eTkxZnFGMGd3Wk1YOWdoUmkwTTk3Y05ySDBFUDBrbExwdlhIY2N4cGtKTFR6UnNoN3RaczdkVjM4WQo3TSt1dEdQUEZBY21tcVIzNkRsblk1VU10aWt5S01qbUl6elRiV0x6QVZheWErQUpCWHBxTGNNckhoSGR3RmVqCmZETU03NitwRmJ4SDMrQytzcm5haWNHMkZJaXUwNytnNm1CY1QyRHd5cmhVRnF4Q1NwckNpZ1RDM2N3bEJ0YTYKNGd4Qm9XMENnWUVBNUR5ZlhLc2tVQjgzN2RiUzBaeldqc0V3cFBzWTRBUmhJQVNlWkZNREY1WWVKWkdOUEREYgpsZ2Q1ZHJpRGxtUjUydnpQa2JtTnRlc1g1Z1pnYkRBVnVaRUd5cVZZU1FKRmdEL1pRUnl6MDhoUkFGaUpQaW5uCllBWWtvT0l3THZQcTNJOUZJRkJtSDNNdDlKbDVDMnFEd3YzMTFDZVJGcjJ6NWJTYjVZNzZMNGNDZ1lFQTh2Nk4KU296N2FPM2NLaU9PeXhMK3A3UUc4UnZ5elB2b2hHc3dCTmlxOEhuNHUwNnBheVJHa1BBRDhUQ2ViMHpXRVFHVgphU2JyUkNndXZ0TENLSjRDUHgyTkUzUXJSVUd1eGkxeVV5dENIT1pLbkQ3aEliQnZvKzZPazkxVm9mYXQxcTVBCktiYUxqZGlxZXdWMUx5cW1rRVBWQlhBdWNMREE5QmU0bk9EUkZ2OENnWUVBcW8valNBMWRoY0xPdVI3aFRXUTMKczFjTVV6NlN5Rlo5ZnIvMDNtUnEyeVdFUWU4VDdQZFdJamhUdlRVR29VMVZBeUlLdkl3K0tzVVZod0VjN2J6QgpmM3V4NTU3STYwYVhTZEJ0T3d1SUY2eUxYQWJPQ1hhblFrdFU5Q1lVZkFJc2NjZGZrVmFEK3R6SWF4S0dNdEhXCnhkR2o5SGZkSlhGL0R4cDVwb1BDMCtFQ2dZQVRaeEgvSHV6QVB5WHlVMjZHZHBqUTZVWVlvSU90ckh1dmZ5T1IKYjMrT3ZoNkhUa3VtMjNtcS93OUJoZ0ZRbjlFRUFKMWVqUllDRmpkTlUyVGZlMlp3aGJxTEVCNllaQnRCaGNWNApNSjhSMGEycGRqZmh5Y1hRVUM4Z1RXOFdCSzF5MCswWnA1TFRHN2JaSmVGcWg3eFBEcXVHeUtOY3FqQnVEU3JYCmsvZitId0tCZ1FDZ0lOMWJDTys3VVMvRnAvVGlZYWwrSXoxT2ZzYXFhUWMzNGtFVm84RFV6Y1UrVkYyczZLQVYKK0dQMjdnT2o1a2VnekRiRFlyZ2xmTkJBN3NMa0tFb2Y3bG9qL1d3T2xMZ1hYN2FtYmFNdWZnNlpENEIyMUpuVQo3Y0NtcWRXN0Z4Z0FId2orYzU1bEhhb0IvNGpzMTNSQXEvKzBWR3N5UzZMb0hDa1lSQmlhL3c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
metadata:
  name: registry-tls
  namespace: default
type: Opaque

